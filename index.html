<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>çŸ­ä¿¡è½¬å‘é…ç½®</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #333; text-align: center; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
    input[type="text"], input[type="password"], input[type="number"], textarea, select { 
      width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; 
    }
    textarea { resize: vertical; min-height: 80px; }
    button { 
      width: 100%; padding: 12px; background: #4CAF50; color: white; border: none; 
      border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; 
    }
    button:hover { background: #45a049; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .label-inline { display:inline; font-weight:normal; margin-left: 5px; }
    .btn-send { background: #2196F3; }
    .btn-send:hover { background: #1976D2; }
    .btn-query { background: #9C27B0; }
    .btn-query:hover { background: #7B1FA2; }
    .btn-info { background: #607D8B; }
    .btn-info:hover { background: #455A64; }
    .btn-ping { background: #FF9800; }
    .btn-ping:hover { background: #F57C00; }
    .btn-flight { background: #E91E63; }
    .btn-flight:hover { background: #C2185B; }
    .section { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
    .section-title { font-size: 18px; color: #333; margin-bottom: 10px; }
    .status { padding: 10px; background: #e7f3fe; border-left: 4px solid #2196F3; margin-bottom: 20px; }
    .warning { padding: 10px; background: #fff3cd; border-left: 4px solid #ffc107; margin-bottom: 20px; font-size: 12px; }
    .hint { font-size: 12px; color: #888; }
    .nav { display: flex; gap: 10px; margin-bottom: 20px; }
    .nav a { 
      flex: 1; text-align: center; padding: 10px; background: #eee; 
      border-radius: 5px; text-decoration: none; color: #333; cursor: pointer;
    }
    .nav a.active { background: #4CAF50; color: white; }
    .nav a:hover:not(.active) { background: #ddd; }
    .push-channel { border: 1px solid #e0e0e0; padding: 12px; margin-bottom: 15px; border-radius: 5px; background: #fafafa; }
    .push-channel-header { display: flex; align-items: center; margin-bottom: 10px; }
    .push-channel-header input[type="checkbox"] { width: auto; margin-right: 8px; }
    .push-channel-header label { margin: 0; font-weight: bold; }
    .push-channel-body { display: none; }
    .push-channel.enabled .push-channel-body { display: block; }
    .push-type-hint { font-size: 11px; color: #666; margin-top: 5px; padding: 8px; background: #f0f0f0; border-radius: 3px; }
    
    /* Toastæç¤ºæ ·å¼ */
    .toast {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
      padding: 15px 30px; border-radius: 8px; color: white; font-weight: bold;
      z-index: 1000; opacity: 0; transition: opacity 0.3s;
    }
    .toast.show { opacity: 1; }
    .toast.success { background: #4CAF50; }
    .toast.error { background: #f44336; }
    
    /* ç™»å½•æ¡†æ ·å¼ */
    .login-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); display: flex; align-items: center; 
      justify-content: center; z-index: 2000;
    }
    .login-box {
      background: white; padding: 30px; border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3); max-width: 350px; width: 90%;
    }
    .login-box h2 { margin-top: 0; text-align: center; color: #333; }
    .login-box .form-group { margin-bottom: 15px; }
    .login-error { color: #f44336; font-size: 12px; margin-top: 10px; text-align: center; display: none; }
    
    /* ç»“æœæ¡†æ ·å¼ */
    .result-box { margin-top: 10px; padding: 10px; border-radius: 5px; display: none; }
    .result-success { background: #e8f5e9; border-left: 4px solid #4CAF50; color: #2e7d32; }
    .result-error { background: #ffebee; border-left: 4px solid #f44336; color: #c62828; }
    .result-loading { background: #fff3e0; border-left: 4px solid #FF9800; color: #e65100; }
    .result-info { background: #e3f2fd; border-left: 4px solid #2196F3; color: #1565c0; }
    
    /* ä¿¡æ¯è¡¨æ ¼æ ·å¼ */
    .info-table { width: 100%; border-collapse: collapse; margin-top: 8px; }
    .info-table td { padding: 5px 8px; border-bottom: 1px solid #ddd; }
    .info-table td:first-child { font-weight: bold; width: 40%; color: #555; }
    
    /* æŒ‰é’®ç»„æ ·å¼ */
    .btn-group { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
    .btn-group button { flex: 1; min-width: 120px; margin-top: 0; }
    
    /* ATæŒ‡ä»¤è°ƒè¯•æ ·å¼ */
    #atLog { 
      background: #333; color: #00ff00; font-family: 'Courier New', Courier, monospace; 
      min-height: 150px; max-height: 300px; overflow-y: auto; padding: 10px; 
      border-radius: 5px; margin-bottom: 10px; font-size: 13px; 
      white-space: pre-wrap; word-break: break-all; 
    }
    .at-input-group { display: flex; gap: 10px; }
    .at-input-group input { flex: 1; font-family: monospace; }
    .at-input-group button { width: auto; min-width: 80px; margin-top: 0; }
  </style>
</head>
<body>
  <!-- ç™»å½•æ¡† -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <h2>ğŸ” ç™»å½•è®¤è¯</h2>
      <div class="form-group">
        <label>ç®¡ç†è´¦å·</label>
        <input type="text" id="loginUser" placeholder="è¯·è¾“å…¥è´¦å·" value="admin">
      </div>
      <div class="form-group">
        <label>ç®¡ç†å¯†ç </label>
        <input type="password" id="loginPass" placeholder="è¯·è¾“å…¥å¯†ç " value="admin123">
      </div>
      <button onclick="doLogin()">ç™»å½•</button>
      <div class="login-error" id="loginError">è´¦å·æˆ–å¯†ç é”™è¯¯ï¼</div>
      <div class="hint" style="margin-top: 15px; text-align: center;">é»˜è®¤è´¦å·: adminï¼Œé»˜è®¤å¯†ç : admin123</div>
    </div>
  </div>

  <!-- Toastæç¤º -->
  <div class="toast" id="toast"></div>

  <div class="container">
    <h1>ğŸ“± çŸ­ä¿¡è½¬å‘å™¨</h1>
    <p style="text-align: center; color: #666; font-size: 14px;">
      æœ¬é¡µé¢ä»…ç”¨äºå±•ç¤ºåŠŸèƒ½ï¼Œå…·ä½“è¯·<a href="https://github.com/chenxuuu/sms_forwarding" target="_blank">è®¿é—®GitHubä»“åº“</a>ã€‚
    </p>
    <div class="nav">
      <a class="active" id="navConfig" onclick="showPage('config')">âš™ï¸ ç³»ç»Ÿé…ç½®</a>
      <a id="navTools" onclick="showPage('tools')">ğŸ§° å·¥å…·ç®±</a>
    </div>
    <div class="status" id="status">è®¾å¤‡IP: <strong>192.168.1.100</strong></div>
    
    <!-- é…ç½®é¡µé¢ -->
    <div id="pageConfig">
      <form id="configForm" onsubmit="saveConfig(event)">
        <div class="section">
          <div class="section-title">ğŸ” Webç®¡ç†è´¦å·è®¾ç½®</div>
          <div class="warning">âš ï¸ é¦–æ¬¡ä½¿ç”¨è¯·ä¿®æ”¹é»˜è®¤å¯†ç ï¼é»˜è®¤è´¦å·: adminï¼Œé»˜è®¤å¯†ç : admin123</div>
          <div class="form-group">
            <label>ç®¡ç†è´¦å·</label>
            <input type="text" name="webUser" id="webUser" placeholder="admin">
          </div>
          <div class="form-group">
            <label>ç®¡ç†å¯†ç </label>
            <input type="password" name="webPass" id="webPass" placeholder="è¯·è®¾ç½®å¤æ‚å¯†ç ">
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">ğŸ“§ é‚®ä»¶é€šçŸ¥è®¾ç½®</div>
          <div class="form-group">
            <label>SMTPæœåŠ¡å™¨</label>
            <input type="text" name="smtpServer" id="smtpServer" placeholder="smtp.qq.com">
          </div>
          <div class="form-group">
            <label>SMTPç«¯å£</label>
            <input type="number" name="smtpPort" id="smtpPort" placeholder="465">
          </div>
          <div class="form-group">
            <label>é‚®ç®±è´¦å·</label>
            <input type="text" name="smtpUser" id="smtpUser" placeholder="your@qq.com">
          </div>
          <div class="form-group">
            <label>é‚®ç®±å¯†ç /æˆæƒç </label>
            <input type="password" name="smtpPass" id="smtpPass" placeholder="æˆæƒç ">
          </div>
          <div class="form-group">
            <label>æ¥æ”¶é‚®ä»¶åœ°å€</label>
            <input type="text" name="smtpSendTo" id="smtpSendTo" placeholder="receiver@example.com">
          </div>
        </div>
        
        <div class="section">
          <div class="section-title">ğŸ”— HTTPæ¨é€é€šé“è®¾ç½®</div>
          <div class="hint" style="margin-bottom:15px;">å¯åŒæ—¶å¯ç”¨å¤šä¸ªæ¨é€é€šé“ï¼Œæ¯ä¸ªé€šé“ç‹¬ç«‹é…ç½®ã€‚æ”¯æŒPOST JSONã€Barkã€GETã€é’‰é’‰ã€PushPlusã€Serveré…±ã€é£ä¹¦ã€Gotifyã€Telegramç­‰å¤šç§æ–¹å¼ã€‚</div>
          
          <div id="pushChannelsContainer"></div>
        </div>
        
        <div class="section">
          <div class="section-title">ğŸ‘¤ ç®¡ç†å‘˜è®¾ç½®</div>
          <div class="form-group">
            <label>ç®¡ç†å‘˜æ‰‹æœºå·</label>
            <input type="text" name="adminPhone" id="adminPhone" placeholder="13800138000">
          </div>
          <div class="hint">ç®¡ç†å‘˜å¯é€šè¿‡çŸ­ä¿¡å‘é€å‘½ä»¤æ§åˆ¶è®¾å¤‡ï¼Œæ”¯æŒä»¥ä¸‹å‘½ä»¤ï¼š<br>
            â€¢ <code>SMS:å·ç :å†…å®¹</code> - è¿œç¨‹å‘é€çŸ­ä¿¡<br>
            â€¢ <code>RESET</code> - é‡å¯è®¾å¤‡
          </div>
        </div>
        
        <button type="submit">ğŸ’¾ ä¿å­˜é…ç½®</button>
      </form>
    </div>
    
    <!-- å·¥å…·ç®±é¡µé¢ -->
    <div id="pageTools" style="display: none;">
      <div class="section">
        <div class="section-title">ğŸ“¤ å‘é€çŸ­ä¿¡</div>
        <div class="form-group">
          <label>ç›®æ ‡å·ç </label>
          <input type="text" id="smsPhone" placeholder="13800138000">
        </div>
        <div class="form-group">
          <label>çŸ­ä¿¡å†…å®¹</label>
          <textarea id="smsContent" placeholder="è¯·è¾“å…¥çŸ­ä¿¡å†…å®¹..." oninput="updateCharCount()"></textarea>
          <div class="hint" style="text-align: right;">å·²è¾“å…¥ <span id="charCount">0</span> å­—ç¬¦</div>
        </div>
        <button class="btn-send" onclick="sendSms()">ğŸ“¨ å‘é€çŸ­ä¿¡</button>
      </div>
      
      <div class="section">
        <div class="section-title">ğŸ“Š æ¨¡ç»„ä¿¡æ¯æŸ¥è¯¢</div>
        <div class="btn-group">
          <button class="btn-query" onclick="queryInfo('ati')">ğŸ“‹ å›ºä»¶ä¿¡æ¯</button>
          <button class="btn-query" onclick="queryInfo('signal')">ğŸ“¶ ä¿¡å·è´¨é‡</button>
        </div>
        <div class="btn-group">
          <button class="btn-info" onclick="queryInfo('siminfo')">ğŸ’³ SIMå¡ä¿¡æ¯</button>
          <button class="btn-info" onclick="queryInfo('network')">ğŸŒ ç½‘ç»œçŠ¶æ€</button>
        </div>
        <div class="btn-group">
          <button style="background:#00BCD4;" onclick="queryInfo('wifi')">ğŸ“¡ WiFiçŠ¶æ€</button>
        </div>
        <div class="result-box" id="queryResult"></div>
      </div>
      
      <div class="section">
        <div class="section-title">ğŸŒ ç½‘ç»œæµ‹è¯•</div>
        <button id="pingBtn" class="btn-ping" onclick="confirmPing()">ğŸ“¡ ç‚¹æˆ‘æ¶ˆè€—ä¸€ç‚¹æµé‡</button>
        <div class="hint">å°†å‘ 8.8.8.8 è¿›è¡Œ ping æ“ä½œï¼Œä¸€æ¬¡æ€§æ¶ˆè€—æå°‘æµé‡è´¹ç”¨</div>
        <div class="result-box" id="pingResult"></div>
      </div>
      
      <div class="section">
        <div class="section-title">âœˆï¸ æ¨¡ç»„æ§åˆ¶</div>
        <div class="btn-group">
          <button id="flightBtn" class="btn-flight" onclick="toggleFlightMode()">âœˆï¸ åˆ‡æ¢é£è¡Œæ¨¡å¼</button>
          <button class="btn-query" onclick="queryFlightMode()">ğŸ” æŸ¥è¯¢çŠ¶æ€</button>
        </div>
        <div class="hint">é£è¡Œæ¨¡å¼å…³é—­æ—¶æ¨¡ç»„å¯æ­£å¸¸æ”¶å‘çŸ­ä¿¡ï¼Œå¼€å¯åå°†å…³é—­å°„é¢‘æ— æ³•ä½¿ç”¨ç§»åŠ¨ç½‘ç»œ</div>
        <div class="result-box" id="flightResult"></div>
      </div>
      
      <div class="section">
        <div class="section-title">ğŸ’» AT æŒ‡ä»¤è°ƒè¯•</div>
        <div id="atLog">ç­‰å¾…è¾“å…¥æŒ‡ä»¤...</div>
        <div class="at-input-group">
          <input type="text" id="atCmd" placeholder="è¾“å…¥ AT æŒ‡ä»¤ï¼Œå¦‚: AT+CSQ">
          <button id="atBtn" onclick="sendAT()">å‘é€</button>
        </div>
        <div class="btn-group" style="margin-top:10px;">
          <button class="btn-info" onclick="clearATLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
        </div>
        <div class="hint">ç›´æ¥å‘æ¨¡ç»„ä¸²å£å‘é€æŒ‡ä»¤å¹¶æ¥æ”¶å“åº”ï¼Œè¯·è°¨æ…æ“ä½œ</div>
      </div>
    </div>
  </div>

  <script>
    // å­˜å‚¨é…ç½®çš„key
    const STORAGE_KEY = 'sms_forwarder_config';
    const AUTH_KEY = 'sms_forwarder_auth';
    
    // é»˜è®¤é…ç½®
    const defaultConfig = {
      webUser: 'admin',
      webPass: 'admin123',
      smtpServer: '',
      smtpPort: 465,
      smtpUser: '',
      smtpPass: '',
      smtpSendTo: '',
      adminPhone: '',
      pushChannels: [
        { enabled: false, type: 1, name: 'é€šé“1', url: '', key1: '', key2: '', customBody: '' },
        { enabled: false, type: 1, name: 'é€šé“2', url: '', key1: '', key2: '', customBody: '' },
        { enabled: false, type: 1, name: 'é€šé“3', url: '', key1: '', key2: '', customBody: '' },
        { enabled: false, type: 1, name: 'é€šé“4', url: '', key1: '', key2: '', customBody: '' },
        { enabled: false, type: 1, name: 'é€šé“5', url: '', key1: '', key2: '', customBody: '' }
      ]
    };
    
    // æ¨é€ç±»å‹é…ç½®
    const PUSH_TYPES = {
      1: { 
        name: 'POST JSONï¼ˆé€šç”¨æ ¼å¼ï¼‰', 
        hint: '<b>POST JSONæ ¼å¼ï¼š</b><br>{"sender":"å‘é€è€…å·ç ","message":"çŸ­ä¿¡å†…å®¹","timestamp":"æ—¶é—´æˆ³"}',
        showExtra: false, showCustom: false
      },
      2: { 
        name: 'Barkï¼ˆiOSæ¨é€ï¼‰', 
        hint: '<b>Barkæ ¼å¼ï¼š</b><br>POST {"title":"å‘é€è€…å·ç ","body":"çŸ­ä¿¡å†…å®¹"}',
        showExtra: false, showCustom: false
      },
      3: { 
        name: 'GETè¯·æ±‚ï¼ˆå‚æ•°åœ¨URLä¸­ï¼‰', 
        hint: '<b>GETè¯·æ±‚æ ¼å¼ï¼š</b><br>URL?sender=xxx&message=xxx&timestamp=xxx',
        showExtra: false, showCustom: false
      },
      4: { 
        name: 'é’‰é’‰æœºå™¨äºº', 
        hint: '<b>é’‰é’‰æœºå™¨äººï¼š</b><br>å¡«å†™Webhookåœ°å€ï¼Œå¦‚éœ€åŠ ç­¾è¯·å¡«Secret',
        showExtra: true, key1Label: 'Secretï¼ˆåŠ ç­¾å¯†é’¥ï¼Œå¯é€‰ï¼‰', key1Placeholder: 'SEC...',
        showKey2: false, showCustom: false
      },
      5: { 
        name: 'PushPlus', 
        hint: '<b>PushPlusï¼š</b><br>å¡«å†™Tokenï¼ŒURLç•™ç©ºä½¿ç”¨é»˜è®¤',
        showExtra: true, key1Label: 'Token', key1Placeholder: 'pushplusçš„token',
        showKey2: true, key2Label: 'å‘é€æ¸ é“', key2Placeholder: 'wechat(default), extension, app',
        showCustom: false
      },
      6: { 
        name: 'Serveré…±', 
        hint: '<b>Serveré…±ï¼š</b><br>å¡«å†™SendKeyï¼ŒURLç•™ç©ºä½¿ç”¨é»˜è®¤',
        showExtra: true, key1Label: 'SendKey', key1Placeholder: 'SCT...',
        showKey2: false, showCustom: false
      },
      7: { 
        name: 'è‡ªå®šä¹‰æ¨¡æ¿', 
        hint: '<b>è‡ªå®šä¹‰æ¨¡æ¿ï¼š</b><br>åœ¨è¯·æ±‚ä½“æ¨¡æ¿ä¸­ä½¿ç”¨ {sender} {message} {timestamp} ä½œä¸ºå ä½ç¬¦',
        showExtra: false, showCustom: true
      },
      8: { 
        name: 'é£ä¹¦æœºå™¨äºº', 
        hint: '<b>é£ä¹¦æœºå™¨äººï¼š</b><br>å¡«å†™Webhookåœ°å€ï¼Œå¦‚éœ€ç­¾åéªŒè¯è¯·å¡«Secret',
        showExtra: true, key1Label: 'Secretï¼ˆç­¾åå¯†é’¥ï¼Œå¯é€‰ï¼‰', key1Placeholder: 'é£ä¹¦æœºå™¨äººçš„ç­¾åå¯†é’¥',
        showKey2: false, showCustom: false
      },
      9: { 
        name: 'Gotify', 
        hint: '<b>Gotifyï¼š</b><br>å¡«å†™æœåŠ¡å™¨åœ°å€ï¼ˆå¦‚ http://gotify.example.comï¼‰ï¼ŒTokenå¡«å†™åº”ç”¨Token',
        showExtra: true, key1Label: 'Tokenï¼ˆåº”ç”¨Tokenï¼‰', key1Placeholder: 'A...',
        showKey2: false, showCustom: false
      },
      10: { 
        name: 'Telegram Bot', 
        hint: '<b>Telegram Botï¼š</b><br>å¡«å†™Chat IDï¼ˆå‚æ•°1ï¼‰å’ŒBot Tokenï¼ˆå‚æ•°2ï¼‰ï¼ŒURLç•™ç©ºé»˜è®¤ä½¿ç”¨å®˜æ–¹API',
        showExtra: true, key1Label: 'Chat ID', key1Placeholder: '123456789',
        showKey2: true, key2Label: 'Bot Token', key2Placeholder: '12345678:ABC...',
        showCustom: false
      }
    };
    
    // æ¨¡æ‹Ÿæ•°æ®
    const mockData = {
      ati: {
        manufacturer: 'CMCC',
        model: 'ML307R',
        version: 'ML307R-DC-MBRH0S00'
      },
      signal: {
        rsrp: -85,
        rsrq: -10.5,
        raw: '99,99,255,255,30,55'
      },
      siminfo: {
        imsi: '460001234567890',
        iccid: '89860123456789012345',
        phoneNum: 'æœªå­˜å‚¨æˆ–ä¸æ”¯æŒ'
      },
      network: {
        regStatus: 'å·²æ³¨å†Œï¼Œæœ¬åœ°ç½‘ç»œ',
        operator: 'CHINA MOBILE',
        pdpStatus: 'å·²æ¿€æ´»',
        apn: 'cmnet'
      },
      wifi: {
        connected: true,
        ssid: 'MyWiFi',
        rssi: -55,
        ip: '192.168.1.100',
        gateway: '192.168.1.1',
        subnet: '255.255.255.0',
        dns: '192.168.1.1',
        mac: 'AA:BB:CC:DD:EE:FF',
        bssid: '11:22:33:44:55:66',
        channel: 6
      },
      flight: {
        mode: 1,  // 1=æ­£å¸¸, 4=é£è¡Œæ¨¡å¼
        modeStr: 'å…¨åŠŸèƒ½æ¨¡å¼ï¼ˆæ­£å¸¸ï¼‰',
        icon: 'ğŸŸ¢'
      }
    };
    
    // åŠ è½½é…ç½®
    function loadConfig() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          const parsed = JSON.parse(saved);
          // ç¡®ä¿pushChannelsæ•°ç»„å®Œæ•´
          if (!parsed.pushChannels || parsed.pushChannels.length < 5) {
            parsed.pushChannels = defaultConfig.pushChannels;
          }
          return { ...defaultConfig, ...parsed };
        } catch (e) {
          return { ...defaultConfig };
        }
      }
      return { ...defaultConfig };
    }
    
    // ä¿å­˜é…ç½®
    function saveConfigToStorage(config) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
    }
    
    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    function checkAuth() {
      const auth = sessionStorage.getItem(AUTH_KEY);
      return auth === 'true';
    }
    
    // ç™»å½•
    function doLogin() {
      const user = document.getElementById('loginUser').value;
      const pass = document.getElementById('loginPass').value;
      const config = loadConfig();
      
      if (user === config.webUser && pass === config.webPass) {
        sessionStorage.setItem(AUTH_KEY, 'true');
        document.getElementById('loginOverlay').style.display = 'none';
        showToast('ç™»å½•æˆåŠŸï¼', 'success');
      } else {
        document.getElementById('loginError').style.display = 'block';
      }
    }
    
    // æ˜¾ç¤ºToast
    function showToast(message, type) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }
    
    // é¡µé¢åˆ‡æ¢
    function showPage(page) {
      document.getElementById('pageConfig').style.display = page === 'config' ? 'block' : 'none';
      document.getElementById('pageTools').style.display = page === 'tools' ? 'block' : 'none';
      document.getElementById('navConfig').classList.toggle('active', page === 'config');
      document.getElementById('navTools').classList.toggle('active', page === 'tools');
    }
    
    // ç”Ÿæˆæ¨é€é€šé“HTML
    function generatePushChannels() {
      const config = loadConfig();
      const container = document.getElementById('pushChannelsContainer');
      let html = '';
      
      for (let i = 0; i < 5; i++) {
        const ch = config.pushChannels[i] || defaultConfig.pushChannels[i];
        const enabledClass = ch.enabled ? ' enabled' : '';
        const checked = ch.enabled ? ' checked' : '';
        
        html += `
          <div class="push-channel${enabledClass}" id="channel${i}">
            <div class="push-channel-header">
              <input type="checkbox" id="push${i}en" onchange="toggleChannel(${i})"${checked}>
              <label for="push${i}en" class="label-inline">å¯ç”¨æ¨é€é€šé“ ${i + 1}</label>
            </div>
            <div class="push-channel-body">
              <div class="form-group">
                <label>é€šé“åç§°</label>
                <input type="text" id="push${i}name" value="${ch.name || ''}" placeholder="è‡ªå®šä¹‰åç§°">
              </div>
              <div class="form-group">
                <label>æ¨é€æ–¹å¼</label>
                <select id="push${i}type" onchange="updateTypeHint(${i})">
                  ${Object.entries(PUSH_TYPES).map(([k, v]) => 
                    `<option value="${k}"${ch.type == k ? ' selected' : ''}>${v.name}</option>`
                  ).join('')}
                </select>
                <div class="push-type-hint" id="hint${i}"></div>
              </div>
              <div class="form-group">
                <label>æ¨é€URL/Webhook</label>
                <input type="text" id="push${i}url" value="${ch.url || ''}" placeholder="http://your-server.com/api æˆ– webhookåœ°å€">
              </div>
              <div id="extra${i}" style="display:none;">
                <div class="form-group">
                  <label id="key1label${i}">å‚æ•°1</label>
                  <input type="text" id="push${i}key1" value="${ch.key1 || ''}" placeholder="">
                </div>
                <div class="form-group" id="key2group${i}" style="display:none;">
                  <label id="key2label${i}">å‚æ•°2</label>
                  <input type="text" id="push${i}key2" value="${ch.key2 || ''}" placeholder="">
                </div>
              </div>
              <div id="custom${i}" style="display:none;">
                <div class="form-group">
                  <label>è¯·æ±‚ä½“æ¨¡æ¿ï¼ˆä½¿ç”¨ {sender} {message} {timestamp} å ä½ç¬¦ï¼‰</label>
                  <textarea id="push${i}body" rows="4" style="font-family:monospace;">${ch.customBody || ''}</textarea>
                </div>
              </div>
            </div>
          </div>
        `;
      }
      container.innerHTML = html;
      
      // åˆå§‹åŒ–æ‰€æœ‰é€šé“çš„ç±»å‹æç¤º
      for (let i = 0; i < 5; i++) {
        updateTypeHint(i);
      }
    }
    
    // åˆ‡æ¢é€šé“å¯ç”¨çŠ¶æ€
    function toggleChannel(idx) {
      const ch = document.getElementById('channel' + idx);
      const cb = document.getElementById('push' + idx + 'en');
      if (cb.checked) {
        ch.classList.add('enabled');
      } else {
        ch.classList.remove('enabled');
      }
    }
    
    // æ›´æ–°ç±»å‹æç¤º
    function updateTypeHint(idx) {
      const sel = document.getElementById('push' + idx + 'type');
      const hint = document.getElementById('hint' + idx);
      const extraFields = document.getElementById('extra' + idx);
      const customFields = document.getElementById('custom' + idx);
      const key2group = document.getElementById('key2group' + idx);
      const type = parseInt(sel.value);
      const typeInfo = PUSH_TYPES[type];
      
      hint.innerHTML = typeInfo.hint;
      
      // éšè—æ‰€æœ‰é¢å¤–å­—æ®µ
      extraFields.style.display = 'none';
      customFields.style.display = 'none';
      key2group.style.display = 'none';
      
      if (typeInfo.showExtra) {
        extraFields.style.display = 'block';
        document.getElementById('key1label' + idx).innerText = typeInfo.key1Label || 'å‚æ•°1';
        document.getElementById('push' + idx + 'key1').placeholder = typeInfo.key1Placeholder || '';
        
        if (typeInfo.showKey2) {
          key2group.style.display = 'block';
          document.getElementById('key2label' + idx).innerText = typeInfo.key2Label || 'å‚æ•°2';
          document.getElementById('push' + idx + 'key2').placeholder = typeInfo.key2Placeholder || '';
        }
      }
      
      if (typeInfo.showCustom) {
        customFields.style.display = 'block';
      }
    }
    
    // å¡«å……è¡¨å•æ•°æ®
    function fillForm() {
      const config = loadConfig();
      document.getElementById('webUser').value = config.webUser || '';
      document.getElementById('webPass').value = config.webPass || '';
      document.getElementById('smtpServer').value = config.smtpServer || '';
      document.getElementById('smtpPort').value = config.smtpPort || 465;
      document.getElementById('smtpUser').value = config.smtpUser || '';
      document.getElementById('smtpPass').value = config.smtpPass || '';
      document.getElementById('smtpSendTo').value = config.smtpSendTo || '';
      document.getElementById('adminPhone').value = config.adminPhone || '';
    }
    
    // ä¿å­˜é…ç½®
    function saveConfig(event) {
      event.preventDefault();
      
      const config = {
        webUser: document.getElementById('webUser').value || 'admin',
        webPass: document.getElementById('webPass').value || 'admin123',
        smtpServer: document.getElementById('smtpServer').value,
        smtpPort: parseInt(document.getElementById('smtpPort').value) || 465,
        smtpUser: document.getElementById('smtpUser').value,
        smtpPass: document.getElementById('smtpPass').value,
        smtpSendTo: document.getElementById('smtpSendTo').value,
        adminPhone: document.getElementById('adminPhone').value,
        pushChannels: []
      };
      
      for (let i = 0; i < 5; i++) {
        config.pushChannels.push({
          enabled: document.getElementById('push' + i + 'en').checked,
          type: parseInt(document.getElementById('push' + i + 'type').value),
          name: document.getElementById('push' + i + 'name').value || 'é€šé“' + (i + 1),
          url: document.getElementById('push' + i + 'url').value,
          key1: document.getElementById('push' + i + 'key1').value,
          key2: document.getElementById('push' + i + 'key2').value,
          customBody: document.getElementById('push' + i + 'body').value
        });
      }
      
      saveConfigToStorage(config);
      showToast('âœ… é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
    }
    
    // æ›´æ–°å­—ç¬¦è®¡æ•°
    function updateCharCount() {
      const content = document.getElementById('smsContent').value;
      document.getElementById('charCount').textContent = content.length;
    }
    
    // å‘é€çŸ­ä¿¡ï¼ˆæ¨¡æ‹Ÿï¼‰
    function sendSms() {
      const phone = document.getElementById('smsPhone').value.trim();
      const content = document.getElementById('smsContent').value.trim();
      
      if (!phone) {
        showToast('âŒ è¯·è¾“å…¥ç›®æ ‡å·ç ', 'error');
        return;
      }
      if (!content) {
        showToast('âŒ è¯·è¾“å…¥çŸ­ä¿¡å†…å®¹', 'error');
        return;
      }
      
      // æ¨¡æ‹Ÿå‘é€å»¶è¿Ÿ
      showToast('ğŸ“¨ æ­£åœ¨å‘é€çŸ­ä¿¡...', 'success');
      setTimeout(() => {
        showToast('âœ… å‡è£…çŸ­ä¿¡å‘é€æˆåŠŸï¼', 'success');
        document.getElementById('smsPhone').value = '';
        document.getElementById('smsContent').value = '';
        updateCharCount();
      }, 1500);
    }
    
    // ç”Ÿæˆä¿¡æ¯è¡¨æ ¼HTML
    function generateInfoTable(data) {
      let html = '<table class="info-table">';
      for (const [key, value] of Object.entries(data)) {
        html += `<tr><td>${key}</td><td>${value}</td></tr>`;
      }
      html += '</table>';
      return html;
    }
    
    // æŸ¥è¯¢æ¨¡ç»„ä¿¡æ¯ï¼ˆæ¨¡æ‹Ÿï¼‰
    function queryInfo(type) {
      const result = document.getElementById('queryResult');
      result.className = 'result-box result-loading';
      result.style.display = 'block';
      result.innerHTML = 'æ­£åœ¨æŸ¥è¯¢ï¼Œè¯·ç¨å€™...';
      
      setTimeout(() => {
        result.className = 'result-box result-info';
        let tableData = {};
        
        if (type === 'ati') {
          tableData = {
            'åˆ¶é€ å•†': mockData.ati.manufacturer,
            'æ¨¡ç»„å‹å·': mockData.ati.model,
            'å›ºä»¶ç‰ˆæœ¬': mockData.ati.version
          };
        } else if (type === 'signal') {
          const rsrp = mockData.signal.rsrp;
          let rsrpDesc = '';
          if (rsrp >= -80) rsrpDesc = '(ä¿¡å·æå¥½)';
          else if (rsrp >= -90) rsrpDesc = '(ä¿¡å·è‰¯å¥½)';
          else if (rsrp >= -100) rsrpDesc = '(ä¿¡å·ä¸€èˆ¬)';
          else if (rsrp >= -110) rsrpDesc = '(ä¿¡å·è¾ƒå¼±)';
          else rsrpDesc = '(ä¿¡å·å¾ˆå·®)';
          
          tableData = {
            'ä¿¡å·å¼ºåº¦ (RSRP)': `${rsrp} dBm ${rsrpDesc}`,
            'ä¿¡å·è´¨é‡ (RSRQ)': `${mockData.signal.rsrq} dB`,
            'åŸå§‹æ•°æ®': mockData.signal.raw
          };
        } else if (type === 'siminfo') {
          tableData = {
            'IMSI': mockData.siminfo.imsi,
            'ICCID': mockData.siminfo.iccid,
            'æœ¬æœºå·ç ': mockData.siminfo.phoneNum
          };
        } else if (type === 'network') {
          tableData = {
            'ç½‘ç»œæ³¨å†Œ': mockData.network.regStatus,
            'è¿è¥å•†': mockData.network.operator,
            'æ•°æ®è¿æ¥': mockData.network.pdpStatus,
            'APN': mockData.network.apn
          };
        } else if (type === 'wifi') {
          const w = mockData.wifi;
          let rssiDesc = '';
          if (w.rssi >= -50) rssiDesc = '(ä¿¡å·æå¥½)';
          else if (w.rssi >= -60) rssiDesc = '(ä¿¡å·å¾ˆå¥½)';
          else if (w.rssi >= -70) rssiDesc = '(ä¿¡å·è‰¯å¥½)';
          else if (w.rssi >= -80) rssiDesc = '(ä¿¡å·ä¸€èˆ¬)';
          else rssiDesc = '(ä¿¡å·è¾ƒå¼±)';
          
          tableData = {
            'è¿æ¥çŠ¶æ€': w.connected ? 'å·²è¿æ¥' : 'æœªè¿æ¥',
            'å½“å‰SSID': w.ssid,
            'ä¿¡å·å¼ºåº¦ (RSSI)': `${w.rssi} dBm ${rssiDesc}`,
            'IPåœ°å€': w.ip,
            'ç½‘å…³': w.gateway,
            'å­ç½‘æ©ç ': w.subnet,
            'DNSæœåŠ¡å™¨': w.dns,
            'MACåœ°å€': w.mac,
            'è·¯ç”±å™¨BSSID': w.bssid,
            'WiFiä¿¡é“': w.channel
          };
        }
        
        result.innerHTML = generateInfoTable(tableData);
      }, 800);
    }
    
    // ç¡®è®¤Pingæ“ä½œ
    function confirmPing() {
      if (confirm("ç¡®å®šè¦æ‰§è¡Œ Ping æ“ä½œå—ï¼Ÿ\n\nè¿™å°†æ¶ˆè€—å°‘é‡æµé‡ã€‚")) {
        doPing();
      }
    }
    
    // Pingæµ‹è¯•ï¼ˆæ¨¡æ‹Ÿï¼‰
    function doPing() {
      const btn = document.getElementById('pingBtn');
      const result = document.getElementById('pingResult');
      
      btn.disabled = true;
      btn.textContent = 'â³ æ­£åœ¨ Ping...';
      result.className = 'result-box result-loading';
      result.style.display = 'block';
      result.innerHTML = 'æ­£åœ¨æ‰§è¡Œ Ping æ“ä½œï¼Œè¯·ç¨å€™ï¼ˆæœ€é•¿ç­‰å¾…30ç§’ï¼‰...';
      
      // æ¨¡æ‹ŸPingå»¶è¿Ÿ
      const delay = Math.floor(Math.random() * 100) + 20;
      setTimeout(() => {
        btn.disabled = false;
        btn.textContent = 'ğŸ“¡ ç‚¹æˆ‘æ¶ˆè€—ä¸€ç‚¹æµé‡';
        result.className = 'result-box result-success';
        result.innerHTML = `âœ… Ping æˆåŠŸï¼<br>ç›®æ ‡: 8.8.8.8, å»¶è¿Ÿ: ${delay}ms, TTL: 115`;
      }, 2000);
    }
    
    // æŸ¥è¯¢é£è¡Œæ¨¡å¼çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿï¼‰
    function queryFlightMode() {
      const result = document.getElementById('flightResult');
      result.className = 'result-box result-loading';
      result.style.display = 'block';
      result.innerHTML = 'æ­£åœ¨æŸ¥è¯¢é£è¡Œæ¨¡å¼çŠ¶æ€...';
      
      setTimeout(() => {
        result.className = 'result-box result-info';
        const f = mockData.flight;
        result.innerHTML = generateInfoTable({
          'å½“å‰çŠ¶æ€': `${f.icon} ${f.modeStr}`,
          'CFUNå€¼': f.mode
        });
      }, 800);
    }
    
    // åˆ‡æ¢é£è¡Œæ¨¡å¼ï¼ˆæ¨¡æ‹Ÿï¼‰
    function toggleFlightMode() {
      if (!confirm('ç¡®å®šè¦åˆ‡æ¢é£è¡Œæ¨¡å¼å—ï¼Ÿ\n\nå¼€å¯é£è¡Œæ¨¡å¼åæ¨¡ç»„å°†æ— æ³•æ”¶å‘çŸ­ä¿¡ã€‚')) return;
      
      const btn = document.getElementById('flightBtn');
      const result = document.getElementById('flightResult');
      btn.disabled = true;
      result.className = 'result-box result-loading';
      result.style.display = 'block';
      result.innerHTML = 'æ­£åœ¨åˆ‡æ¢é£è¡Œæ¨¡å¼...';
      
      setTimeout(() => {
        btn.disabled = false;
        // åˆ‡æ¢æ¨¡æ‹Ÿæ•°æ®
        if (mockData.flight.mode === 1) {
          mockData.flight.mode = 4;
          mockData.flight.modeStr = 'é£è¡Œæ¨¡å¼ï¼ˆå°„é¢‘å…³é—­ï¼‰';
          mockData.flight.icon = 'âœˆï¸';
          result.className = 'result-box result-success';
          result.innerHTML = 'âœ… å·²å¼€å¯é£è¡Œæ¨¡å¼ âœˆï¸<br>æ¨¡ç»„å°„é¢‘å·²å…³é—­ï¼Œæ— æ³•æ”¶å‘çŸ­ä¿¡';
        } else {
          mockData.flight.mode = 1;
          mockData.flight.modeStr = 'å…¨åŠŸèƒ½æ¨¡å¼ï¼ˆæ­£å¸¸ï¼‰';
          mockData.flight.icon = 'ğŸŸ¢';
          result.className = 'result-box result-success';
          result.innerHTML = 'âœ… å·²å…³é—­é£è¡Œæ¨¡å¼ ğŸŸ¢<br>æ¨¡ç»„æ¢å¤æ­£å¸¸å·¥ä½œ';
        }
      }, 1500);
    }
    
    // ATæŒ‡ä»¤æ—¥å¿—
    function addATLog(msg, type = 'resp') {
      const log = document.getElementById('atLog');
      const div = document.createElement('div');
      
      if (type === 'user') {
        div.innerHTML = '<b style="color:#fff;">&gt; </b>' + escapeHtml(msg);
      } else if (type === 'error') {
        div.innerHTML = '<b style="color:#f44336;">âŒ </b>' + escapeHtml(msg);
      } else {
        div.innerHTML = '<b style="color:#4CAF50;">[RESP] </b>' + escapeHtml(msg);
      }
      
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }
    
    // HTMLè½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // å‘é€ATæŒ‡ä»¤ï¼ˆæ¨¡æ‹Ÿï¼‰
    function sendAT() {
      const input = document.getElementById('atCmd');
      const cmd = input.value.trim();
      if (!cmd) return;
      
      const btn = document.getElementById('atBtn');
      btn.disabled = true;
      btn.textContent = '...';
      
      addATLog(cmd, 'user');
      input.value = '';
      
      // æ¨¡æ‹ŸATå“åº”
      setTimeout(() => {
        let response = '';
        const cmdUpper = cmd.toUpperCase();
        
        if (cmdUpper === 'AT' || cmdUpper === 'AT+CGMI') {
          response = 'OK';
        } else if (cmdUpper === 'ATI') {
          response = mockData.ati.manufacturer + '\n' + mockData.ati.model + '\n' + mockData.ati.version + '\nOK';
        } else if (cmdUpper === 'AT+CSQ') {
          response = '+CSQ: 20,99\nOK';
        } else if (cmdUpper === 'AT+CFUN?') {
          response = '+CFUN: ' + mockData.flight.mode + '\nOK';
        } else if (cmdUpper === 'AT+CIMI') {
          response = mockData.siminfo.imsi + '\nOK';
        } else if (cmdUpper === 'AT+ICCID') {
          response = '+ICCID: ' + mockData.siminfo.iccid + '\nOK';
        } else if (cmdUpper.startsWith('AT+')) {
          response = 'OK';
        } else {
          response = 'ERROR';
        }
        
        addATLog(response);
        btn.disabled = false;
        btn.textContent = 'å‘é€';
      }, 500);
    }
    
    // æ¸…ç©ºATæ—¥å¿—
    function clearATLog() {
      document.getElementById('atLog').innerHTML = 'æ—¥å¿—å·²æ¸…ç©ºï¼Œç­‰å¾…è¾“å…¥æŒ‡ä»¤...';
    }
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      const config = loadConfig();
      document.getElementById('loginUser').value = config.webUser;
      document.getElementById('loginPass').value = config.webPass;
      
      // æ£€æŸ¥ç™»å½•çŠ¶æ€
      if (checkAuth()) {
        document.getElementById('loginOverlay').style.display = 'none';
      }
      
      // ç»‘å®šç™»å½•æ¡†å›è½¦äº‹ä»¶
      document.getElementById('loginPass').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') doLogin();
      });
      document.getElementById('loginUser').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('loginPass').focus();
      });
      
      // ATæŒ‡ä»¤å›è½¦å‘é€
      document.getElementById('atCmd').addEventListener('keydown', function(e) {
        if (e.key === 'Enter') sendAT();
      });
      
      // ç”Ÿæˆæ¨é€é€šé“HTML
      generatePushChannels();
      
      // å¡«å……è¡¨å•æ•°æ®
      fillForm();
    });
  </script>
</body>
</html>
